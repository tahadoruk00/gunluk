<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YKS & SÃ¼reÃ§ Takip</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        :root { --dark: #1e272e; --tyt: #3498db; --ayt: #9b59b6; --red: #e84118; --bg: #f5f6fa; --green: #2ecc71; --user-color: #6c5ce7; }
        body { font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); margin: 0; padding: 15px; display: flex; justify-content: center; color: var(--dark); transition: 0.3s; }
        .container { background: white; width: 100%; max-width: 420px; border-radius: 35px; padding: 20px; box-shadow: 0 15px 50px rgba(0,0,0,0.1); }
        
        /* Dinamik Quote KartÄ± */
        .quote-card { background: var(--user-color); color: white; padding: 20px; border-radius: 25px; margin-bottom: 20px; transition: 0.5s; }
        #dailyQuote { font-size: 14px; font-weight: 600; font-style: italic; line-height: 1.5; margin: 0; }
        .quote-author { font-size: 11px; opacity: 0.8; margin-top: 8px; display: block; font-weight: 700; text-transform: uppercase; }

        .exam-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat-card { background: #fff; padding: 12px; border-radius: 20px; text-align: center; border: 1px solid #f1f1f1; }
        .stat-val { font-size: 15px; font-weight: 800; display: block; }
        .stat-label { font-size: 9px; color: #95a5a6; font-weight: 700; text-transform: uppercase; }

        .process-card { background: #fff; padding: 15px; border-radius: 20px; text-align: center; border: 1px solid #fceaea; margin-bottom: 20px; }
        .process-val { font-size: 16px; font-weight: 800; color: var(--red); display: block; }
        
        /* KullanÄ±cÄ± SeÃ§imi */
        .user-selector { display: flex; gap: 12px; margin-bottom: 20px; }
        .profile-card { flex: 1; text-align: center; cursor: pointer; opacity: 0.4; transition: 0.3s; padding: 15px; border-radius: 22px; background: #f8f9fa; position: relative; border: 2px solid transparent; }
        .profile-card.active { opacity: 1; background: #fff; transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        #card-taha.active { border-color: #3498db; }
        #card-sude.active { border-color: #e84393; }

        textarea { width: 100%; height: 90px; padding: 15px; border-radius: 20px; border: 2px solid #f1f1f1; box-sizing: border-box; font-family: inherit; resize: none; outline: none; font-size: 15px; }
        .custom-file-upload { display: flex; align-items: center; justify-content: center; gap: 8px; background: #f8f9fa; padding: 12px; border-radius: 15px; cursor: pointer; font-weight: 700; font-size: 13px; margin-top: 10px; border: 2px dashed #eee; }

        .save-btn { background: var(--user-color); color: white; border: none; padding: 18px; border-radius: 22px; width: 100%; font-weight: 800; cursor: pointer; margin: 15px 0; font-size: 15px; transition: 0.4s; }
        
        /* ArÅŸiv AkÄ±ÅŸÄ± (Alt Alta Mesajlar) */
        .archive-display { margin-bottom: 20px; }
        .archive-title { font-size: 12px; font-weight: 800; color: #95a5a6; text-transform: uppercase; margin-bottom: 10px; display: block; text-align: center; }
        .note-bubble { background: #fff; border: 1px solid #eee; padding: 15px; border-radius: 20px; margin-bottom: 10px; position: relative; animation: slideIn 0.3s ease-out; }
        .note-time { font-size: 10px; color: #ccc; position: absolute; top: 10px; right: 15px; }
        .note-text { font-size: 14px; color: #2c3e50; line-height: 1.4; white-space: pre-wrap; margin-top: 5px; }
        .note-img { width: 100%; border-radius: 12px; margin-top: 10px; }

        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Takvim */
        .calendar-box { background: #fff; border-radius: 25px; padding: 15px; border: 1px solid #f1f1f1; }
        .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; font-weight: 800; }
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .cal-day { font-size: 12px; padding: 8px 0; border-radius: 10px; cursor: pointer; text-align: center; }
        .cal-day.selected { background: var(--user-color) !important; color: white !important; font-weight: bold; }
        
        #previewContainer img { width: 100%; border-radius: 20px; margin-top: 10px; border: 2px solid var(--user-color); }
        .nav-btn { background: #f1f2f6; border: none; width: 28px; height: 28px; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div class="quote-card" id="mainQuoteCard">
        <p id="dailyQuote">...</p>
        <span class="quote-author" id="quoteAuthor"></span>
    </div>

    <div class="exam-grid">
        <div class="stat-card"><span class="stat-val" id="tytCount" style="color: var(--tyt);">--:--</span><span class="stat-label">TYT 2026</span></div>
        <div class="stat-card"><span class="stat-val" id="aytCount" style="color: var(--ayt);">--:--</span><span class="stat-label">AYT 2026</span></div>
    </div>

    <div class="process-card">
        <span class="process-val" id="awayLive">...</span>
        <span class="stat-label">SÃ¼reÃ§ Takibi</span>
    </div>

    <div class="user-selector">
        <div class="profile-card" id="card-taha" onclick="toggleDiary('taha')">
            <span id="name-taha">Taha</span>
        </div>
        <div class="profile-card" id="card-sude" onclick="toggleDiary('sude')">
            <span id="name-sude">Sude</span>
        </div>
    </div>

    <div id="diary-area" style="display:none;">
        <textarea id="noteInput" placeholder="Neler baÅŸardÄ±n?"></textarea>
        <label class="custom-file-upload">
            <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="previewImage()">
            ðŸ“¸ FotoÄŸraf Ekle
        </label>
        <div id="previewContainer"></div>
        <button id="saveButton" class="save-btn" onclick="saveToFirebase()">GÃ¼nÃ¼ ArÅŸivle</button>

        <div class="archive-display">
            <span class="archive-title" id="archiveDateTitle">GÃ¼nÃ¼n AkÄ±ÅŸÄ±</span>
            <div id="notesFlow"></div>
        </div>

        <div class="calendar-box">
            <div class="cal-header">
                <button class="nav-btn" onclick="changeMonth(-1)">â€¹</button>
                <span id="monthYear">...</span>
                <button class="nav-btn" onclick="changeMonth(1)">â€º</button>
            </div>
            <div class="cal-grid" id="calendarGrid"></div>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAUnANfxQb3-8rG-ws3l08XD5vGWGdtb2Y",
        authDomain: "yks-gunluk.firebaseapp.com",
        databaseURL: "https://yks-gunluk-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "yks-gunluk",
        storageBucket: "yks-gunluk.firebasestorage.app",
        messagingSenderId: "603273107081",
        appId: "1:603273107081:web:06fc327f84cb1fddd01858"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentUserId = '';
    let selectedImageBase64 = "";
    let viewDate = new Date();
    let selectedDateStr = new Date().toLocaleDateString('en-CA');

    function toggleDiary(userId) {
        if (currentUserId === userId) {
            currentUserId = '';
            document.getElementById('diary-area').style.display = 'none';
            document.querySelectorAll('.profile-card').forEach(c => c.classList.remove('active'));
            document.documentElement.style.setProperty('--user-color', '#6c5ce7');
        } else {
            currentUserId = userId;
            const color = (userId === 'taha') ? '#3498db' : '#e84393';
            document.documentElement.style.setProperty('--user-color', color);
            
            document.querySelectorAll('.profile-card').forEach(c => c.classList.remove('active'));
            document.getElementById('card-' + userId).classList.add('active');
            document.getElementById('diary-area').style.display = 'block';
            selectDay(new Date().toLocaleDateString('en-CA'));
        }
    }

    function selectDay(dateStr) {
        selectedDateStr = dateStr;
        const options = { day: 'numeric', month: 'long' };
        document.getElementById('archiveDateTitle').innerText = new Date(dateStr).toLocaleDateString('tr-TR', options) + " AkÄ±ÅŸÄ±";
        renderCalendar();
        loadArchive(); 
    }

    // Yeni: NotlarÄ± akÄ±ÅŸ ÅŸeklinde yÃ¼kler
    function loadArchive() {
        const flow = document.getElementById('notesFlow');
        if (!currentUserId) return;

        db.ref(`notes/${currentUserId}/${selectedDateStr}`).on('value', snap => {
            flow.innerHTML = "";
            const data = snap.val();
            if (data) {
                // NotlarÄ± zamana gÃ¶re sÄ±rala (Firebase ID'leri kronolojiktir)
                Object.values(data).reverse().forEach(note => {
                    const time = note.timestamp ? new Date(note.timestamp).toLocaleTimeString('tr-TR', {hour: '2-digit', minute:'2-digit'}) : "";
                    const html = `
                        <div class="note-bubble">
                            <span class="note-time">${time}</span>
                            <div class="note-text">${note.text}</div>
                            ${note.image ? `<img src="${note.image}" class="note-img">` : ""}
                        </div>
                    `;
                    flow.innerHTML += html;
                });
            } else {
                flow.innerHTML = `<div style="text-align:center; color:#ccc; font-size:13px; padding:20px;">HenÃ¼z bir ÅŸey eklenmemiÅŸ.</div>`;
            }
        });
    }

    // Yeni: ÃœstÃ¼ne yazmaz, yeni kayÄ±t ekler (push)
    function saveToFirebase() {
        const input = document.getElementById('noteInput');
        const btn = document.getElementById('saveButton');
        if(!input.value && !selectedImageBase64) return;

        const newNoteRef = db.ref(`notes/${currentUserId}/${selectedDateStr}`).push();
        newNoteRef.set({
            text: input.value,
            image: selectedImageBase64,
            timestamp: firebase.database.ServerValue.TIMESTAMP
        }).then(() => {
            input.value = "";
            selectedImageBase64 = "";
            document.getElementById('previewContainer').innerHTML = "";
            btn.innerText = "âœ“ Eklendi";
            setTimeout(() => btn.innerText = "GÃ¼nÃ¼ ArÅŸivle", 1500);
        });
    }

    function renderCalendar() {
        const grid = document.getElementById("calendarGrid");
        grid.innerHTML = "";
        const month = viewDate.getMonth();
        const year = viewDate.getFullYear();
        document.getElementById("monthYear").innerText = new Intl.DateTimeFormat('tr-TR', { month: 'long', year: 'numeric' }).format(viewDate);
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const offset = firstDay === 0 ? 6 : firstDay - 1;
        for(let i=0; i<offset; i++) grid.innerHTML += `<div></div>`;
        for(let d=1; d<=daysInMonth; d++) {
            const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
            const isSelected = dateStr === selectedDateStr ? 'selected' : '';
            grid.innerHTML += `<div class="cal-day ${isSelected}" onclick="selectDay('${dateStr}')">${d}</div>`;
        }
    }

    function previewImage() {
        const file = document.getElementById('fileInput').files[0];
        if (file) {
            const reader = new FileReader();
            reader.onloadend = () => {
                selectedImageBase64 = reader.result;
                document.getElementById('previewContainer').innerHTML = `<img src="${selectedImageBase64}">`;
            };
            reader.readAsDataURL(file);
        }
    }

    function changeMonth(val) { viewDate.setMonth(viewDate.getMonth() + val); renderCalendar(); }
    
    function updateTimers() {
        const now = new Date();
        const tyt = new Date("June 20, 2026 10:15:00");
        const ayt = new Date("June 21, 2026 10:15:00");
        const start = new Date("2026-02-08T22:35:00");
        const calc = (target) => {
            const diff = target - now;
            return `${Math.floor(diff/86400000)}g ${Math.floor((diff%86400000)/3600000)}s ${Math.floor((diff%3600000)/60000)}dk`;
        }
        document.getElementById("tytCount").innerText = calc(tyt);
        document.getElementById("aytCount").innerText = calc(ayt);
        const diffS = now - start;
        document.getElementById("awayLive").innerText = `${Math.floor(diffS/86400000)}g ${Math.floor((diffS%86400000)/3600000)}s ${Math.floor((diffS%3600000)/60000)}dk`;
    }

    const quotes = [{s:"Gelecek, hayallerine inananlarÄ±ndÄ±r.",a:"Roosevelt"},{s:"Zorluklar baÅŸarÄ±yÄ± deÄŸerli kÄ±lar.",a:"AtatÃ¼rk"},{s:"DurmadÄ±ÄŸÄ±n sÃ¼rece yavaÅŸ gitmen mÃ¼him deÄŸil.",a:"KonfÃ¼Ã§yÃ¼s"}];
    function setRandomQuote() {
        const q = quotes[Math.floor(Math.random() * quotes.length)];
        document.getElementById('dailyQuote').innerText = q.s;
        document.getElementById('quoteAuthor').innerText = "â€” " + q.a;
    }

    setRandomQuote();
    setInterval(updateTimers, 60000);
    updateTimers();
</script>
</body>
</html>
